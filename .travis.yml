language: php
php:
    - 7.1
    - 7.2
    - 7.3
    - nightly

env:
    - DEPENDENCIES=highest
    - DEPENDENCIES=lowest

install: |
    if [ "$DEPENDENCIES" = "lowest" ]; then
        composer update -n --prefer-stable --prefer-dist --prefer-lowest
    else
        composer update -n --prefer-stable --prefer-dist
    fi

script: make test

stages:
    - Code quality
    - Test

jobs:
    allow_failures:
        - php: nightly

    include:
        - stage: Code quality
          name: Lint
          php: 7.3
          script: make lint
        - name: Coding standard
          php: 7.3
          script: make cs
        - name: Static analysis
          php: 7.3
          script: make static-analysis
